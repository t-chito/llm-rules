---
description: comprehensive code review
argument-hint [directory]
allowed-tools: Edit(*.md), Write(*.md)
reference: https://zenn.dev/razokulover/articles/058fede74dbbe0
---

# Code Review Command

## 要求

$ARGUMENTS ディレクトリを見て、コードレビューを行います。

## 出力形式

レビュー結果は以下の構成で、$ARGUMENTS ディレクトリに `review_result.md` というファイル名で出力します。

1. 全体に関わるコメント (以下のような「行単位ではなく PR 全体に関わるコメント」がある場合のみ)
   1.1 PR や issue 自体についての疑問
   1.2 複数ファイルにまたがる問題
   1.3 アーキテクチャレベルの懸念

2. ファイル・行番号ごとのレビュー及び suggestion

このとき、md の記法として、テーブル、セクション、バレットリスト、コードブロックのみの使用を許可します。逆に、強調表示や絵文字は使用しないでください。

また、良い点や適切であるコードに対してはレビューコメントを残してはいけません。変更や対応が必要な箇所に対してのみ、丁寧で協力的な表現でコメントや提案を行います。

### 例) 全体に関わるコメント

```
[ask] このPRでユーザー認証の仕組みを大幅に変更されていますが、既存のセッション管理との互換性はいかがでしょうか

[must] データベーススキーマの変更が含まれているようですが、マイグレーションファイルが見当たりません
本番環境でのデータ移行方法を明確にしていただけますか

[ask] issue では「検索機能の改善」となっていますが、実装では認証機能も大幅に変更されているように見えます
この変更は issue の範囲に含まれているのでしょうか

[imo] 複数のコントローラーで同様のバリデーションロジックが重複しているように見えます
共通のバリデーションクラスを作成したほうが良さそうです

[must] 環境変数の追加が含まれているようですが、README やデプロイ手順書に設定方法の記載がないように見えます
運用チームが設定できるよう、ドキュメントの更新をお願いします
```

### 例) ファイルや行番号ごとのレビューや suggestion

```
src/services/UserManager.ts:42-48
[must] SQLインジェクションのリスクがあるように見えます
パラメータ化クエリを使ったほうが良さそうです
現在: const query = `SELECT * FROM users WHERE id = ${userId}`;
```

```
src/services/UserManager.ts:120-145
[must] このクラスは認証とレポート生成の両方を担当していて、責務が多岐にわたっているようです

レポート生成を ReportGenerator に分離することで、変更時の影響範囲を限定できそうです
```

```
src/models/User.ts:15
[ask] こちら Enum の方が型安全に思ったのですがいかがでしょうか
```

```
src/controllers/UserController.ts:78-82
[imo] エラーレスポンスの形式を揃えるために、共通のエラーハンドラーを導入するのはどうでしょうか
フロントエンドでの処理が簡潔になりそうです
```

```
src/utils/validators.ts:34
[nits] 変数名をもう少し具体的にすると、コードがより読みやすくなります
例: tmp → temporaryUserData
```

## レビューアプローチ

### 1. 実装の妥当性チェック

以下のチェックリストに基づいて評価を行います。

- 目的・方針の適切性

  - 変更内容がビジネス要件・設計仕様と合致しているか
  - そもそもこの実装で解決すべき課題かどうか

- 実装範囲の妥当性

  - 変更すべきファイル／機能に抜け漏れはないか
  - 不要なファイル／機能の変更が含まれていないか
  - 例外ケースやエラーハンドリング等、考慮すべき項目が網羅されているか

- ロジックの正しさ

  - 条件分岐やループなど、主要な処理フローが仕様どおり動作するか
  - エッジケース（境界値、異常系）が想定内かどうか

- 既存機能への影響

  - 後方互換性が保たれているか
  - 他モジュール／サービスとの連携に問題がないか

- 外部依存の扱い

  - API 呼び出し／DB 操作の引数・戻り値が正しいか
  - タイムアウトや例外時のリトライ設計が適切か

### 2. 設計意図の確認

実装の「Why」に焦点を当てた質問を通じて、設計判断の妥当性を確認します。特に以下の観点から質問を構成します。

- なぜこのアプローチを選択したのか
- 他の選択肢を検討したか、検討した場合なぜ採用しなかったのか
- 将来的な拡張性や保守性は考慮されているか
- パフォーマンスやセキュリティの観点から最適な選択か

### 3. 技術的な詳細レビュー

`./tech-review-rules/` 以下のガイドラインに従い、厳密な技術レビューを実施します。

- `general_code_review_guide.md` の一般的なコードレビューガイドライン
- `rails_specific_code_review_guide.md` の Rails 固有のレビューガイドライン（該当する場合）
- `reviewer_personality.md` に記載されている観点での評価
