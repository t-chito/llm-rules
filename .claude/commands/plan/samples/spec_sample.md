# Engineering Task Specification Template

## 概要 (Summary)

ユーザーが TODO リストにタグ機能を追加して、タスクを分類・フィルタできるようにする

## 背景・課題 (Background)

現在の TODO アプリではタスクが増えると管理が困難になり、ユーザーから「仕事用」「個人用」などでタスクを分類したいという要望が多く寄せられている。

## 仕様 (Specification)

### 機能要件

- タスク作成時にタグを複数選択・追加できる
- 既存タスクにもタグを後から追加・削除できる
- タグでフィルタリング表示ができる
- タグ一覧の表示・編集・削除ができる

### 受入条件

- Given タスク作成画面で When タグを選択して保存 Then タスクにタグが紐づいて表示される
- Given タスク一覧画面で When 特定タグでフィルタ Then そのタグのタスクのみ表示される

## 実装方針 (Implementation Approach)

### 技術的アプローチ

- DB に tags テーブルと task_tags の中間テーブルを追加
- フロントエンドは React Select コンポーネントでタグ選択 UI
- 既存の TodoService クラスにタグ関連メソッドを追加

### 設計判断・代替案検討

**選択した方針**: 多対多の関係で中間テーブル方式を採用  
**代替案**: JSON カラムにタグ ID を配列で保存  
**判断理由**: クエリの柔軟性とパフォーマンスを重視。将来的なタグ分析機能も考慮  
**トレードオフ**: テーブル数は増えるが、複雑なフィルタリングが高速で実行できる

**選択した方針**: タグの色はプリセットから選択式  
**代替案**: ユーザーがカラーピッカーで自由に色を選択  
**判断理由**: UI の一貫性とアクセシビリティを優先  
**トレードオフ**: カスタマイズ性は劣るが、色の衝突や視認性の問題を回避

## テスト方針 (Testing Strategy)

- 単体テスト: タグ CRUD、フィルタリングロジック
- 統合テスト: API 経由でのタグ操作
- E2E テスト: タグ作成 → タスク紐づけ → フィルタの一連の流れ

## 図・ダイアグラム (Diagrams)

### データモデル

```
[Task] ←→ [TaskTag] ←→ [Tag]
  id      task_id      id
  title   tag_id       name
  ...     created_at   color
```

### UI フロー

```
タスク作成画面 → タグ選択 → 保存 → 一覧表示(タグ付き)
     ↓
タグフィルタ → フィルタ結果表示
```

### API 設計

```
GET /api/tags - タグ一覧取得
POST /api/tasks/:id/tags - タスクにタグ追加
DELETE /api/tasks/:id/tags/:tagId - タグ削除
```

## 作業リスト (Task Breakdown)

- [ ] タグテーブルのマイグレーション作成
- [ ] Tag、TaskTag モデルの実装
- [ ] タグ関連 API エンドポイント実装

### Phase 2: フロントエンド (2 日)

- [ ] タグ選択コンポーネント作成
- [ ] タスク作成・編集画面にタグ機能追加
- [ ] タグフィルタ機能実装

### Phase 3: テスト・調整 (0.5 日)

- [ ] テストコード作成
- [ ] 動作確認・バグ修正

## 今回考慮しなかった項目

**リスク分析**: タグ機能は既存技術の組み合わせで実装でき、技術的リスクが低いため省略  
**非機能要件**: 既存のパフォーマンス・セキュリティ要件を継承し、新たな制約が発生しないため省略  
**段階的リリース**: 機能の影響範囲が限定的で、一括リリースでも問題ないため省略

## 参考資料 (References)

- 関連 Issue: #123 タグ機能要望
- UI モックアップ: Figma リンク
- React Select ドキュメント: https://react-select.com/
- 既存 Todo API 仕様書: docs/api.md

---

**見積工数**: 4 人日 | **優先度**: High
