---
description: ユーザーが指摘した問題点を確認・検証し、原因と対策を提示する
argument-hint [message]
allowed-tools: Edit(*.md), Write(*.md)
model: sonnet
---

ユーザーが指摘した問題点について確認・検証してください。

## フォーマット

- $ARGUMENTS に --md オプションが指定された場合は、検証結果を markdown ファイルに書き出してください
- 構成は「確認結果」「原因」「対策」の順としてください。

```
【確認結果】
問題の有無と概要を1行で述べる。

【原因】
3行以内で問題の原因を説明する。
参照した情報があれば別途列挙する（行数制限の対象外）。

【対策】
具体的な修正方法や改善案を提示する。
```

## 検証ルール

### 問題がない場合
- 指摘が誤解に基づいている理由を具体的に説明する
- 正しい理解のための根拠（コード、ドキュメント、仕様など）を明示する
- なぜその実装・説明が適切なのか、責任を持って説明する

### 問題がある場合
- なぜ間違えたのか、誤りの原因を分析する
- 単に迎合するのではなく、技術的な根拠に基づいて改善策を提示する
- 同様の誤りを防ぐための方策も含める

## 具体例

### 誤った指摘への反論

<blame>
さっきのコードで配列の要素にアクセスする前に長さチェックしてないよ
</blame>

<answer>
【確認結果】
指摘された問題はありません。長さチェックは適切に実装されています。

【原因】
- 該当コードでは forEach を使用しており、空配列の場合は処理がスキップされます
- 配列要素へのアクセスは forEach のコールバック内で行われるため、範囲外アクセスは発生しません
- 参照：実装コード (line 23-28)

【対策】
現在の実装で問題ありませんが、可読性向上のため以下のようにコメントを追加することを検討します。
```javascript
// 空配列の場合は forEach がスキップされるため、長さチェック不要
items.forEach(item => {
  processItem(item);
});
```
</answer>

### 実装の誤り指摘（正当な指摘）

<blame>
React の useEffect は非同期関数を直接受け取れるって言ったけど、それ間違ってるよね？
</blame>

<answer>
【確認結果】
ご指摘の通り、私の説明が誤っていました。

【原因】
- useEffect のコールバックは同期関数でなければならないという仕様を見落としていました
- useEffect は cleanup 関数または undefined を返す必要があり、Promise を返してはいけません
- この制約を理解せずに不正確な情報を提供してしまいました

【対策】
正しい実装方法を以下に示します。
```javascript
useEffect(() => {
  const fetchData = async () => {
    const result = await api.getData();
    setData(result);
  };
  fetchData();
}, []);
```
今後は React の仕様を正確に確認してから回答します。
</answer>

### 部分的に正しい指摘

<blame>
データベースの接続プールを 150 に増やすって言ったけど、メモリ不足になるのでは？
</blame>

<answer>
【確認結果】
メモリ制約の考慮が不十分でした。ただし、150 が必ず問題になるわけではありません。

【原因】
- サーバーの具体的なメモリ容量を確認せずに提案していました
- 一般的な環境では 150 接続でも問題ないケースが多いですが、環境依存の要素を軽視していました
- メモリ使用量の事前検証を提案に含めていませんでした

【対策】
以下の手順で安全に対応します。
1. 現在のメモリ使用状況と空き容量を確認する
2. 1接続あたりのメモリ使用量を実測する（環境により5-20MB程度）
3. 段階的に接続数を増やし、120→130→150 と調整する
4. メトリクスを監視しながら最適値を決定する
</answer>
